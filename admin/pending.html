{% extends "admin/base.html" %}

{% block content %}
<section x-data="searchResultsComponent('pending')" x-init="onLoad" @search.window="onSearch">
    <template x-if="!id && loading['entries.search'] !== true">
        <header class="pending-header">
            <hgroup>
                <h2><span x-text="total"></span> pending entries</h2>
                <p>Entries awaiting review</p>
            </hgroup>
            <template x-if="total > 0">
                <a href="#" role="button" class="outline contrast" @click.prevent="onClearPending()">Clear all</a>
            </template>
        </header>
    </template>
    <template x-if="loading['entries.search'] === true">
        <article aria-busy="true"></article>
    </template>

    <template x-for="e in entries" :key="e.id">
        <article>
            <header>
                <hgroup>
                    <h3>
                        <template x-if="e.status === 'pending'"><mark>New</mark></template>
                        <a href="#" @click.prevent="onEditEntry(e)">
                            <template x-for="(item, idx) in e.content" :key="idx">
                                <span><span x-text="item"></span><span x-show="idx < e.content.length - 1">, </span></span>
                            </template>
                        </a>
                    </h3>
                    <p x-text="config.languages[e.lang].name"></p>
                </hgroup>
                <nav>
                    <ul>
                        <li><a href="#" @click.prevent="onEditEntry(e)" class="secondary">Edit</a></li>
                        <li><a href="#" @click.prevent="onDeleteEntry(e.id)" class="contrast">Delete</a></li>
                    </ul>
                </nav>
            </header>

            <template x-if="e.id in comments && 'null' in comments[e.id]">
                <template x-for="(c, n) in comments[e.id]['null']" :key="c.id">
                    <blockquote>
                        <p x-text="c.comments"></p>
                        <footer>
                            <button class="outline secondary small" @click.prevent="onClearComments(c.id)">Clear</button>
                        </footer>
                    </blockquote>
                </template>
            </template>

            <template x-if="e.phones.length > 0">
                <p><em x-text="e.phones.join(', ')"></em></p>
            </template>

            <div class="definitions-list">
                <template x-for="(r, n) in e.relations" :key="r.id">
                    <div class="definition-row" :class="{ 'is-reordered': order[e.id] && order[e.id].changedRels[r.id] }">
                        <div>
                            <small class="secondary">
                                <template x-if="r.status === 'pending'"><mark>New</mark></template>
                                <template x-if="r.relation.status === 'pending'"><ins>Pending</ins></template>
                                <span x-text="config.languages[r.lang].name + (r.relation.types ? ' Â· ' + r.relation.types : '')"></span>
                            </small>
                            <p>
                                <template x-for="(item, idx) in r.content" :key="idx">
                                    <span><span x-text="item"></span><span x-show="idx < r.content.length - 1">, </span></span>
                                </template>
                            </p>
                        </div>
                        <template x-if="e.id in comments && r.id in comments[e.id]">
                            <template x-for="(c, n) in comments[e.id][r.id]" :key="c.id">
                                <blockquote>
                                    <p x-text="c.comments"></p>
                                    <footer>
                                        <button class="outline secondary small" @click.prevent="onClearComments(c.id)">Clear</button>
                                    </footer>
                                </blockquote>
                            </template>
                        </template>
                        <nav class="def-actions">
                            <a href="#" @click.prevent="onEditRelation(r, e)">Relation</a>
                            <a href="#" @click.prevent="onEditEntry(r, e)">Edit</a>
                            <a href="#" @click.prevent="onDetatchRelation(e.id, r.relation.id)">Detach</a>
                            <a href="#" @click.prevent="onDeleteRelationEntry(r.id)" class="contrast">Delete</a>
                            <span role="group">
                                <button class="outline secondary" @click.prevent="onReorderRelation(e, r, n, -1)">&uarr;</button>
                                <button class="outline secondary" @click.prevent="onReorderRelation(e, r, n, 1)">&darr;</button>
                            </span>
                        </nav>
                    </div>
                </template>
            </div>

            <footer>
                <a href="#" role="button" class="outline" @click.prevent="onAddDefinition(e)">+ Add definition</a>
                <template x-if="order[e.id]">
                    <div role="group">
                        <button class="secondary" @click.prevent="onResetRelationOrder(e)">Reset</button>
                        <button @click.prevent="onSaveRelationOrder(e)">Save order</button>
                    </div>
                </template>
                <template x-if="!(e.id in comments)">
                    <div role="group">
                        <button @click.prevent="onApproveSubmission(e.id)">Approve all</button>
                        <button class="secondary" @click.prevent="onRejectSubmission(e.id)">Reject all</button>
                    </div>
                </template>
            </footer>
        </article>
    </template>
</section>

{% include "admin/relation.html" %}
{% include "admin/definition.html" %}
{% endblock %}
