<div x-data="relationComponent()"
    @open-relation-form.window="onOpen"
    @keyup.escape.window="onClose"
    @close-relation-form.window="onClose">
    <template x-if="isVisible">
        <aside class="side-panel">
            <header>
                <h3>Edit relation</h3>
                <button class="outline secondary" @click.prevent="onClose">&times;</button>
            </header>

            <form @submit.prevent="onSave">
                <figure class="relation-diagram">
                    <div x-text="entry.parent.content"></div>
                    <span>&darr;</span>
                    <div x-text="entry.content"></div>
                </figure>

                <template x-if="Object.keys(config.languages[entry.lang].types).length > 0">
                    <div>
                        <label>
                            Relation type
                            <select x-model="entry.relation.types" multiple>
                                <template x-for="[id, typ] in Object.entries(config.languages[entry.lang].types)" :key="id">
                                    <option :value="id" x-text="typ" x-bind:selected="entry.relation.types.indexOf(id) > -1"></option>
                                </template>
                            </select>
                        </label>

                        <label>
                            Tags
                            <textarea x-model="entry.relation.tags" rows="2" placeholder="One per line"></textarea>
                        </label>
                    </div>
                </template>

                <label>
                    Notes
                    <textarea x-model="entry.relation.notes" rows="2"></textarea>
                </label>

                <fieldset role="group">
                    <button type="submit">Save</button>
                    <button type="button" class="secondary" @click.prevent="onClose">Cancel</button>
                </fieldset>
            </form>

            <footer>
                <small>
                    <strong>Relation ID:</strong> <code x-text="entry.relation.id"></code> &middot;
                    <strong>Parent ID:</strong> <code x-text="entry.parent.id"></code><br>
                    <strong>Definition ID:</strong> <code x-text="entry.id"></code> &middot;
                    <strong>Created:</strong> <span x-text="entry.relation.created_at.slice(0, 16).replace('T', ' ')"></span>
                </small>
            </footer>
        </aside>
    </template>
</div>
