<div x-data="definitionComponent()"
    @open-definition-form.window="onOpen"
    @keyup.escape.window="onClose"
    @close-definition-form.window="onClose">
    <template x-if="isVisible">
        <aside class="side-panel">
            <header>
                <h3>Add definition</h3>
                <button class="outline secondary" @click.prevent="onClose">&times;</button>
            </header>

            <form @submit.prevent="onSave">
                <figure class="relation-diagram">
                    <template x-for="(item, idx) in parent.content" :key="idx">
                        <p x-text="item"></p>
                    </template>
                    <span>&darr;</span>
                </figure>

                <label>
                    Definition
                    <template x-for="(item, idx) in def.content" :key="idx">
                        <fieldset class="group content-input">
                            <textarea x-model="def.content[idx]" required :autofocus="idx === 0" rows="2"></textarea>
                            <button type="button" class="secondary" @click.prevent="onDeleteDefContentItem(idx)" x-show="def.content.length > 1">&times;</button>
                        </fieldset>
                    </template>
                </label>
                <p><a href="#" @click.prevent="onAddDefContentItem">+ Add variant</a></p>

                <template x-if="Object.keys(config.languages[parent.lang].types).length > 0">
                    <div>
                        <div class="row">
                            <label class="col col-6">
                                Language
                                <select x-model="def.lang">
                                    <template x-for="[id, l] in Object.entries(config.languages)" :key="id">
                                        <option :value="id" x-text="l.name"></option>
                                    </template>
                                </select>
                            </label>
                            <label class="col col-6">
                                Relation type
                                <select x-model="def.types" multiple required>
                                    <template x-for="[id, typ] in Object.entries(config.languages[def.lang].types)" :key="id">
                                        <option :value="id" x-text="typ"></option>
                                    </template>
                                </select>
                            </label>
                        </div>

                        <label>
                            Tags
                            <textarea x-model="def.tags" rows="2" placeholder="One per line"></textarea>
                        </label>
                    </div>
                </template>

                <label>
                    Notes
                    <textarea x-model="def.notes" rows="2"></textarea>
                </label>

                <fieldset class="group">
                    <button type="submit">Save</button>
                    <button type="button" class="secondary" @click.prevent="onClose">Cancel</button>
                </fieldset>
            </form>
        </aside>
    </template>
</div>
