<div x-data="entryComponent()"
    @open-entry-form.window="onOpen"
    @keyup.escape.window="onClose"
    @close-entry-form.window="onClose" class="entry-form">
    <template x-if="isVisible">
        <aside class="side-panel">
            <header>
                <h3 x-text="isNew ? 'New entry' : 'Edit entry'"></h3>
                <button class="outline secondary" @click.prevent="onClose">&times;</button>
            </header>

            <form @submit.prevent="onSave">
                <label data-field>
                    Content
                    <template x-for="(item, idx) in entry.content" :key="idx">
                        <fieldset class="group content-input">
                            <textarea x-model="entry.content[idx]" required :autofocus="idx === 0" rows="2" autofocus></textarea>
                            <button type="button" class="secondary" @click.prevent="onDeleteContentItem(idx)" x-show="entry.content.length > 1">&times;</button>
                        </fieldset>
                    </template>
                </label>
                <p><a href="#" @click.prevent="onAddContentItem">+ Add variant</a></p>

                <div class="row">
                    <label class="col col-6">
                        Language
                        <select x-model="entry.lang" required>
                            <template x-for="[id, l] in Object.entries(config.languages)" :key="id">
                                <option :value="id" x-text="l.name" x-bind:selected="id === entry.lang"></option>
                            </template>
                        </select>
                    </label>
                    <label class="col col-6" data-field>
                        Initial
                        <input type="text" x-model="entry.initial" @focus="onFocusInitial" required aria-describedby="initial-hint" />
                        <small data-hint id="initial-hint">Initial alphabet/character of the word for the A-Z glossary.</small>
                    </label>
                </div>

                <details>
                    <summary>
                        <span class="icon-link">
                            <img class="icon" src="/admin/static/settings.svg?v={{ asset_ver }}" alt="" /> Advanced options
                        </span>
                    </summary>
                    <div class="row">
                        <label class="col col-6" data-field>
                            Status
                            <select x-model="entry.status" required aria-describedby="status-hint">
                                <option value="enabled">Enabled</option>
                                <option value="disabled">Disabled</option>
                            </select>
                            <small data-hint id="status-hint">Disabled entries are hidden from public</small>
                        </label>
                        <label class="col col-6" data-field>
                            Weight
                            <input type="number" step="0.01" x-model="entry.weight" placeholder="0 = auto" aria-describedby="weight-hint" />
                            <small data-hint id="weight-hint">(Optional). Only set if this word has to be specifically boosted above other results. Smaller values rank higher</small>
                        </label>
                    </div>

                    <label data-field>
                        Phonetic notations
                        <textarea x-model="entry.phones" rows="2" placeholder="One per line" aria-describedby="phones-hint"></textarea>
                        <small data-hint id="phones-hint">Pronunciation, IPA etc.</small>
                    </label>

                    <label data-field>
                        Tags
                        <textarea x-model="entry.tags" rows="2" placeholder="One per line" aria-describedby="tags-hint"></textarea>
                        <small data-hint id="tags-hint">One or more tags categorizing the entry. One per line.</small>
                    </label>

                    <label data-field>
                        Search tokens
                        <textarea x-model="entry.tokens" rows="2" placeholder="One per line (blank = auto)" aria-describedby="tokens-hint"></textarea>
                        <small data-hint id="tokens-hint">Fulltext / stemmed tokens for fulltext search. One per line.</small>
                    </label>

                    <label data-field>
                        Notes
                        <textarea x-model="entry.notes" rows="2" aria-describedby="notes-hint"></textarea>
                        <small data-hint id="notes-hint">Optional description</small>
                    </label>

                    <label data-field>
                        Meta (JSON)
                        <textarea x-model="entry.meta_str" rows="2" aria-describedby="meta-hint"></textarea>
                        <small data-hint id="meta-hint">Optional JSON attributes that can be used in templates</small>
                    </label>
                </details>

                <br />
                <div class="row">
                    <div class="col-4">
                        <div class="hstack">
                            <button type="submit" x-bind:aria-busy="loading['entries.update'] === true || loading['entries.create'] === true">Save</button>
                            <button type="button" class="secondary" @click.prevent="onClose">Cancel</button>
                        </div>
                    </div>
                    <div class="col-8 col-end">
                        <button x-if="!isNew" @click.prevent="onDeleteEntry" class="danger">Delete entry</button>
                    </div>
                </div>
                <br />
            </form>

            <footer x-show="!isNew">
                <template x-if="parentEntries.length > 0">
                    <article class="card mt-6">
                        <h3>Parent entries (<span x-text="parentEntries.length"></span>)</h3>
                        <ul class="unstyled meta">
                            <template x-for="r in parentEntries" :key="r.id">
                                <li>
                                    <a x-bind:href="makeURL({'id': r.id})">
                                        <template x-for="(item, idx) in r.content" :key="idx">
                                            <span><span x-text="item"></span><span x-show="idx < r.content.length - 1">, </span></span>
                                        </template>
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </article>
                </template>

                <article class="card">
                    <ul class="unstyled meta">
                        <li><label>ID</label> <code x-text="entry.id"></code></li>
                        <li><label>GUID</label> <code x-text="entry.guid"></code><br></li>
                        <li><label>Created</label> <span x-text="entry.created_at?.slice(0, 16).replace('T', ' ')"></span></li>
                        <li><label>Updated</label> <span x-text="entry.updated_at?.slice(0, 16).replace('T', ' ')"></span></li>
                    </ul>
                </article>
            </footer>
        </aside>
    </template>
</div>
