<div x-data="entryComponent()"
    @open-entry-form.window="onOpen"
    @keyup.escape.window="onClose"
    @close-entry-form.window="onClose" class="entry-form">
    <template x-if="isVisible">
        <aside class="side-panel">
            <header>
                <h3 x-text="isNew ? 'New entry' : 'Edit entry'"></h3>
                <button class="outline secondary" @click.prevent="onClose">&times;</button>
            </header>

            <form @submit.prevent="onSave">
                <label>
                    Content
                    <template x-for="(item, idx) in entry.content" :key="idx">
                        <fieldset role="group" class="content-input">
                            <textarea x-model="entry.content[idx]" required :autofocus="idx === 0" rows="2" autofocus></textarea>
                            <button type="button" class="secondary" @click.prevent="onDeleteContentItem(idx)" x-show="entry.content.length > 1">&times;</button>
                        </fieldset>
                    </template>
                </label>
                <p><a href="#" @click.prevent="onAddContentItem">+ Add variant</a></p>

                <div class="grid">
                    <label>
                        Language
                        <select x-model="entry.lang" required>
                            <template x-for="[id, l] in Object.entries(config.languages)" :key="id">
                                <option :value="id" x-text="l.name" x-bind:selected="id === entry.lang"></option>
                            </template>
                        </select>
                    </label>
                    <label>
                        Initial
                        <input type="text" x-model="entry.initial" @focus="onFocusInitial" required />
                        <small class="help">Initial alphabet/character of the word for the A-Z glossary.</small>
                    </label>
                </div>

                <details>
                    <summary>
                        <span class="icon-link">
                            <img class="icon" src="/admin/static/settings.svg?v={{ asset_ver }}" alt="" /> Advanced options
                        </span>
                    </summary>
                    <div class="grid">
                        <label>
                            Status
                            <select x-model="entry.status" required>
                                <option value="enabled">Enabled</option>
                                <option value="disabled">Disabled</option>
                            </select>
                            <small class="help">Disabled entries are hidden from public</small>
                        </label>
                        <label>
                            Weight
                            <input type="number" step="0.01" x-model="entry.weight" placeholder="0 = auto" />
                            <small class="help">Smaller values rank higher</small>
                        </label>
                    </div>

                    <label>
                        Phonetic notations
                        <textarea x-model="entry.phones" rows="2" placeholder="One per line"></textarea>
                        <small class="help">Pronunciation, IPA etc.</small>
                    </label>

                    <label>
                        Tags
                        <textarea x-model="entry.tags" rows="2" placeholder="One per line"></textarea>
                        <small class="help">One or more tags categorizing the entry. One per line.</small>
                    </label>

                    <label>
                        Search tokens
                        <textarea x-model="entry.tokens" rows="2" placeholder="One per line (blank = auto)"></textarea>
                        <small class="help">Fulltext / stemmed tokens for fulltext search. One per line.</small>
                    </label>

                    <label>
                        Notes
                        <textarea x-model="entry.notes" rows="2"></textarea>
                        <small class="help">Optional description</small>
                    </label>

                    <label>
                        Meta (JSON)
                        <textarea x-model="entry.meta_str" rows="2"></textarea>
                        <small class="help">Optional JSON attributes that can be used in templates</small>
                    </label>
                </details>

                <fieldset role="group" class="buttons">
                    <button type="submit" x-bind:aria-busy="loading['entries.update'] === true || loading['entries.create'] === true">Save</button>
                    <button type="button" class="secondary" @click.prevent="onClose">Cancel</button>
                </fieldset>
                <p x-show="!isNew"><a href="#" class="contrast icon-link" @click.prevent="onDeleteEntry"><img class="icon" src="/admin/static/delete.svg?v={{ asset_ver }}" alt="" />Delete this entry</a></p>
            </form>

            <footer x-show="!isNew">
                <ul class="meta">
                    <li><strong>ID:</strong> <code x-text="entry.id"></code></li>
                    <li><strong>GUID:</strong> <code x-text="entry.guid"></code><br></li>
                    <li><strong>Created:</strong> <span x-text="entry.created_at?.slice(0, 16).replace('T', ' ')"></span></li>
                    <li><strong>Updated:</strong> <span x-text="entry.updated_at?.slice(0, 16).replace('T', ' ')"></span></li>
                </ul>
                <template x-if="parentEntries.length > 0">
                    <div>
                        <p><strong>Parent entries (<span x-text="parentEntries.length"></span>)</strong></p>
                        <ul class="meta">
                            <template x-for="r in parentEntries" :key="r.id">
                                <li>
                                    <a x-bind:href="makeURL({'id': r.id})">
                                        <template x-for="(item, idx) in r.content" :key="idx">
                                            <span><span x-text="item"></span><span x-show="idx < r.content.length - 1">, </span></span>
                                        </template>
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>
            </footer>
        </aside>
    </template>
</div>
